<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Design and Implementation Details &mdash; PODIO  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=7f41d439"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Data Models and Data Model Definitions" href="datamodel_syntax.html" />
    <link rel="prev" title="Introduction" href="doc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            PODIO
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="doc.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc.html#quick-start">Quick-start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Design and Implementation Details</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#layout-of-objects">Layout of Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-user-layer">The User Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-internal-data-layer">The Internal Data Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-pod-layer">The POD Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-collections">The Collections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vectorization-support-notebook-pattern">Vectorization support / notebook pattern</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#handling-mutability">Handling mutability</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="datamodel_syntax.html">Data Models and Data Model Definitions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="datamodel_syntax.html#basic-concepts-and-supported-features">Basic Concepts and Supported Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="datamodel_syntax.html#definition-of-custom-components">Definition of custom components</a></li>
<li class="toctree-l2"><a class="reference internal" href="datamodel_syntax.html#definition-of-custom-data-classes">Definition of custom data classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="datamodel_syntax.html#defining-members">Defining members</a></li>
<li class="toctree-l3"><a class="reference internal" href="datamodel_syntax.html#definition-of-references-between-objects">Definition of references between objects:</a></li>
<li class="toctree-l3"><a class="reference internal" href="datamodel_syntax.html#explicit-definition-of-methods">Explicit definition of methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="datamodel_syntax.html#global-options">Global options</a></li>
<li class="toctree-l2"><a class="reference internal" href="datamodel_syntax.html#extending-a-datamodel-using-types-from-an-upstream-datamodel">Extending a datamodel / using types from an upstream datamodel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="datamodel_syntax.html#potential-pitfalls">Potential pitfalls</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples for Supported Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples.html#object-ownership">Object Ownership</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#object-creation-and-storage">Object Creation and Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#object-references">Object References</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#looping-through-collections">Looping through Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#support-for-notebook-pattern">Support for Notebook-Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#podio-frame-container"><code class="docutils literal notranslate"><span class="pre">podio::Frame</span></code> container</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#object-retrieval">Object Retrieval</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#user-defined-meta-data">User defined Meta Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples.html#python-interface">Python Interface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="frame.html">The <code class="docutils literal notranslate"><span class="pre">Frame</span></code> concept</a><ul>
<li class="toctree-l2"><a class="reference internal" href="frame.html#basic-functionality-of-a-frame">Basic functionality of a <code class="docutils literal notranslate"><span class="pre">Frame</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="frame.html#usage-examples-for-collection-data">Usage examples for collection data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="frame.html#putting-collection-data-into-the-frame">Putting collection data into the <code class="docutils literal notranslate"><span class="pre">Frame</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="frame.html#getting-collection-references-from-the-frame">Getting collection (references) from the <code class="docutils literal notranslate"><span class="pre">Frame</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="frame.html#usage-for-parameters">Usage for Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="frame.html#i-o-basics-and-philosophy">I/O basics and philosophy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="frame.html#writing-a-frame">Writing a <code class="docutils literal notranslate"><span class="pre">Frame</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="frame.html#reading-a-frame">Reading a <code class="docutils literal notranslate"><span class="pre">Frame</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="frame.html#schema-evolution">Schema evolution</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="frame.html#frame-implementation-and-design">Frame implementation and design</a></li>
<li class="toctree-l1"><a class="reference internal" href="userdata.html">Writing extra data outside an EDM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="userdata.html#example-usage">Example usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="userdata.html#some-limitations">Some limitations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="userdata.html#no-relations-to-other-collections">No relations to other collections</a></li>
<li class="toctree-l3"><a class="reference internal" href="userdata.html#limited-supported-types">Limited supported types</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="advanced_topics.html">Advanced Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="advanced_topics.html#writing-extra-data-outside-the-edm">Writing extra data outside the EDM</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_topics.html#changing-creating-new-templates">Changing / creating new templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_topics.html#persistency">Persistency</a><ul>
<li class="toctree-l3"><a class="reference internal" href="advanced_topics.html#writing-back-end">Writing Back-End</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_topics.html#reading-back-end">Reading Back-End</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_topics.html#dumping-json">Dumping JSON</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="advanced_topics.html#thread-safety">Thread-safety</a><ul>
<li class="toctree-l3"><a class="reference internal" href="advanced_topics.html#changing-user-data">Changing user data</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_topics.html#serialization">Serialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_topics.html#not-thread-safe-components">Not-thread-safe components</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="advanced_topics.html#running-pre-commit">Running pre-commit</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_topics.html#retrieving-the-edm-definition-from-a-data-file">Retrieving the EDM definition from a data file</a><ul>
<li class="toctree-l3"><a class="reference internal" href="advanced_topics.html#accessing-the-edm-definition-programmatically">Accessing the EDM definition programmatically</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_topics.html#technical-details-on-edm-definition-embedding">Technical details on EDM definition embedding</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced_topics.html#the-datamodelregistry">The <code class="docutils literal notranslate"><span class="pre">DatamodelRegistry</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced_topics.html#i-o-helpers-for-edm-definition-storing">I/O helpers for EDM definition storing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">Changing / creating new templates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="templates.html#preprocessing-of-yaml-file">Preprocessing of yaml file</a></li>
<li class="toctree-l2"><a class="reference internal" href="templates.html#existing-templates">Existing templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="templates.html#adding-a-new-template">Adding a new template</a></li>
<li class="toctree-l2"><a class="reference internal" href="templates.html#available-information-in-the-templates">Available information in the templates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="templates.html#general-information">General information</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#components">Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#datatypes">Datatypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#membervariable"><code class="docutils literal notranslate"><span class="pre">MemberVariable</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#datatype"><code class="docutils literal notranslate"><span class="pre">DataType</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#julia-code-generation">Julia code generation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PODIO</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Design and Implementation Details</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="design-and-implementation-details">
<h1>Design and Implementation Details<a class="headerlink" href="#design-and-implementation-details" title="Link to this heading"></a></h1>
<p>The driving considerations for the PODIO design are:</p>
<ol class="arabic simple">
<li><p>the concrete data are contained within plain-old-data structures (PODs)</p></li>
<li><p>user-exposed data types are concrete and do not use inheritance</p></li>
<li><p>The C++ and Python interface should look as close as possible</p></li>
<li><p>The user does not do any explicit memory management</p></li>
<li><p>Classes are generated using a higher-level abstraction and code generators</p></li>
</ol>
<p>The following sections give some more technical details and explanations for the design choices.
More concrete implementation details can be found in the doxygen documentation.</p>
<section id="layout-of-objects">
<h2>Layout of Objects<a class="headerlink" href="#layout-of-objects" title="Link to this heading"></a></h2>
<p>The data model is based on four different kind of objects and layers, namely</p>
<ol class="arabic simple">
<li><p>user visible (physics) classes (e.g. <code class="docutils literal notranslate"><span class="pre">Hit</span></code>). These act as transparent references to the underlying data,</p></li>
<li><p>a transient object knowing about all data for a certain physics object, including inter-object relations (e.g. <code class="docutils literal notranslate"><span class="pre">HitObject</span></code>),</p></li>
<li><p>a plain-old-data (POD) type holding the persistent object information (e.g. <code class="docutils literal notranslate"><span class="pre">HitData</span></code>), and</p></li>
<li><p>a user-visible collection containing the physics objects (e.g. <code class="docutils literal notranslate"><span class="pre">HitCollection</span></code>).</p></li>
</ol>
<p>These layers are described in the following.</p>
<section id="the-user-layer">
<h3>The User Layer<a class="headerlink" href="#the-user-layer" title="Link to this heading"></a></h3>
<p>The user visible objects (e.g. <code class="docutils literal notranslate"><span class="pre">Hit</span></code>) act as light-weight references to the underlying data, and provide the necessary user interface. They come in two flavors, mutable and immutable, where the mutable classes are easily recognizable by their name (e.g. <code class="docutils literal notranslate"><span class="pre">MutableHit</span></code>).
Mutable classes are implicitly converted to immutable ones if necessary, so that interfaces that require only reading access to the data should always use the immutable classes. Only in cases where explicit mutability of the objects is required should mutable classes appear in interface definitions.</p>
<p>For each of the data-members and <code class="docutils literal notranslate"><span class="pre">OneToOneRelations</span></code> declared in the data model definition, corresponding getters (and setters for the mutable classes) are generated.
For each of the <code class="docutils literal notranslate"><span class="pre">OneToManyRelations</span></code> and <code class="docutils literal notranslate"><span class="pre">VectorMembers</span></code> a vector-like interface is provided.</p>
<p>With the chosen interface, the code written in C++ and Python looks almost identical, if taking proper advantage of the <code class="docutils literal notranslate"><span class="pre">auto</span></code> keyword.</p>
</section>
<section id="the-internal-data-layer">
<h3>The Internal Data Layer<a class="headerlink" href="#the-internal-data-layer" title="Link to this heading"></a></h3>
<p>The internal objects give access to the object data, i.e. the POD, and the references to other objects.
These objects inherit from <code class="docutils literal notranslate"><span class="pre">podio::ObjBase</span></code>, which takes care of object identification (<code class="docutils literal notranslate"><span class="pre">podio::ObjectID</span></code>), and object-ownership. The <code class="docutils literal notranslate"><span class="pre">ObjectID</span></code> consists of the index of the object and an ID of the collection it belongs to. If the object does not belong to a collection yet, the data object owns the POD containing the real data, otherwise the POD is owned by the respective collection. For details about the inter-object references and their handling within the data objects please see below.</p>
</section>
<section id="the-pod-layer">
<h3>The POD Layer<a class="headerlink" href="#the-pod-layer" title="Link to this heading"></a></h3>
<p>The plain-old-data (POD) contain just the data declared in the <code class="docutils literal notranslate"><span class="pre">Members</span></code> section of the datamodel definition as well as some bookkeeping data for data types with <code class="docutils literal notranslate"><span class="pre">OneToManyRelations</span></code> or <code class="docutils literal notranslate"><span class="pre">VectorMembers</span></code>. Ownership and lifetime of the PODs is managed by the other parts of the infrastructure, namely the data objects and the data collections.</p>
</section>
<section id="the-collections">
<h3>The Collections<a class="headerlink" href="#the-collections" title="Link to this heading"></a></h3>
<p>The collections created serve three purposes:</p>
<ol class="arabic simple">
<li><p>giving access to or creating the data items</p></li>
<li><p>preparing objects for writing into PODs or preparing them after reading</p></li>
<li><p>support for the so-called notebook pattern</p></li>
</ol>
<p>When used via the so called factory pattern (i.e. using the <code class="docutils literal notranslate"><span class="pre">create</span></code> function to create new objects) a collection will return mutable objects.
It is important to note that objects that are “owned” by a collection (i.e. they are either created via <code class="docutils literal notranslate"><span class="pre">create</span></code> or they are added to the collection via <code class="docutils literal notranslate"><span class="pre">push_back</span></code>) become invalid and can no longer be used once a collection is <code class="docutils literal notranslate"><span class="pre">clear</span></code>ed.</p>
</section>
<section id="vectorization-support-notebook-pattern">
<h3>Vectorization support / notebook pattern<a class="headerlink" href="#vectorization-support-notebook-pattern" title="Link to this heading"></a></h3>
<p>As an end-user oriented library, PODIO provides only a limited support for struct-of-arrays (SoA) memory layouts. In the vision, that the data used for heavy calculations is best copied locally, the library provides convenience methods for extracting the necessary information from the collections. More details can be found in the examples section of this document.</p>
</section>
</section>
<section id="handling-mutability">
<h2>Handling mutability<a class="headerlink" href="#handling-mutability" title="Link to this heading"></a></h2>
<p>Depending on the policy of the client of PODIO, data collections may be read-only after creation, or may be altered still.
While the base assumption of PODIO is that once-created collections are immutable once leaving the scope of its creator,
it still allows for explicit <code class="docutils literal notranslate"><span class="pre">unfreezing</span></code> collections afterwards.
This feature has to handled with care, as it heavily impacts thread-safety.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Key4hep authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v99-99-99
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions"><dl>
      <dt>Versions</dt>
      <dd><a href="../docs-on-gh-pages/design.html">docs-on-gh-pages</a></dd>
      <dd><a href="../master/design.html">master</a></dd>
      <dd><a href="../v00-00-00/design.html">v00-00-00</a></dd>
      <dd><a href="../v00-99/design.html">v00-99</a></dd>
      <dd><a href="design.html">v99-99-99</a></dd>
    </dl></div>
</div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>